<!DOCTYPE html>
<html>
<head>
	<title>Secure your Website from SQL Injections | BookOfZeus</title>
	<meta name="description" content="Learn how to sanitze and prevent SQL injections using PHP" />
	<meta name="author" content="BookOfZeus" />
	<meta name="robots" content="index, follow" />
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />

	<meta name="google-site-verification" content="5IAePxZxNggUiJp9G82ARb7Wfo7AOTEpa-WHjEiwt1g" />
	<meta name="msvalidate.01" content="B5DFA066FA5291D9CB34785B1BC6675D" />
	<meta name="alexaVerifyID" content="vQHSFVDphyxYyFdLXh_rjrFaCwc" />
	<meta name="y_key" content="1541c56d97401c05" />	

	<meta name="DC.Creator" content="BookOfZeus" />
	<meta name="DC.Language" content="en" />

	<link href="https://plus.google.com/109493568868519843460" rel="publisher" />

	<link rel="author" href="https://plus.google.com/109493568868519843460">
	<link rel="shortcut icon" href="/media/favicon.ico" />
	<link rel="icon" href="/media/favicon.ico" />


	<link rel="image_src" href="/media/logo.png" />

	<link rel="canonical" href="http://bookofzeus.com/articles/mysql/secure-your-website-from-sql-injections" />
	<link rel="stylesheet" type="text/css" href="/media/modern.css" media="all" />
	<link href='http://fonts.googleapis.com/css?family=Muli' rel='stylesheet' type='text/css'>

	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-23468853-1']);
	  _gaq.push(['_trackPageview']);
	  (function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	</script>
</head>
<body id="body">

<!-- menu -->
<div id="menu">
	<img src="/media/menu.png" class="nav-toggler toggle-slide-left" alt="show or hide menu" width="24" height="24" />
	<div id="home2">
		Book<span>Of</span>Zeus
	</div>
</div>

<aside class="menu slide-menu-left">
	<header id="home">
		<div>
			<img src="/media/logo.png" alt="logo" width="57" height="57" />
			Book<span>Of</span>Zeus
		</div>
		<span>Articles, Tutorials &amp; Source Code</span>
	</header>

	<nav>
		<button class="close-menu">Close Menu</button>
		<ul>

	<li class="header"><a href="/arduino/" title="Arduino" >Arduino</a>
	
		<ul>
		
			<li class="item"><a href="/arduino/sensor-module-cheat-sheet/" title="Sensor and Module Cheat Sheet" >Sensor and Module Cheat Sheet</a></li>
		
		</ul>
	
	</li>

	<li class="header"><a href="/articles/" title="Articles" class="selected">Articles</a>
	
		<ul>
		
			<li class="item"><a href="/articles/android/" title="Android" >Android</a></li>
		
			<li class="item"><a href="/articles/apache/" title="Apache" >Apache</a></li>
		
			<li class="item"><a href="/articles/css/" title="CSS" >CSS</a></li>
		
			<li class="item"><a href="/articles/documentation/" title="Documentation" >Documentation</a></li>
		
			<li class="item"><a href="/articles/git/" title="Git" >Git</a></li>
		
			<li class="item"><a href="/articles/html/" title="HTML" >HTML</a></li>
		
			<li class="item"><a href="/articles/javascript/" title="Javascript" >Javascript</a></li>
		
			<li class="item"><a href="/articles/jquery/" title="jQuery" >jQuery</a></li>
		
			<li class="item"><a href="/articles/linux/" title="Linux" >Linux</a></li>
		
			<li class="item"><a href="/articles/mobile/" title="Mobile" >Mobile</a></li>
		
			<li class="item"><a href="/articles/mongo/" title="Mongo" >Mongo</a></li>
		
			<li class="item"><a href="/articles/mysql/" title="MySQL" class="selected">MySQL</a></li>
		
			<li class="item"><a href="/articles/optimization/" title="Optimization" >Optimization</a></li>
		
			<li class="item"><a href="/articles/php/" title="PHP" >PHP</a></li>
		
			<li class="item"><a href="/articles/python/" title="Python" >Python</a></li>
		
			<li class="item"><a href="/articles/sass/" title="Sass" >Sass</a></li>
		
			<li class="item"><a href="/articles/subversion/" title="Subversion" >Subversion</a></li>
		
		</ul>
	
	</li>

	<li class="header"><a href="/contribute/" title="Contribute" >Contribute</a>
	
	</li>

	<li class="header"><a href="/customize-ubuntu/" title="Customize Ubuntu" >Customize Ubuntu</a>
	
		<ul>
		
			<li class="item"><a href="/customize-ubuntu/editor/" title="Editor" >Editor</a></li>
		
			<li class="item"><a href="/customize-ubuntu/environment/" title="Environment" >Environment</a></li>
		
			<li class="item"><a href="/customize-ubuntu/flash-player/" title="Flash Player" >Flash Player</a></li>
		
			<li class="item"><a href="/customize-ubuntu/fonts/" title="Fonts" >Fonts</a></li>
		
			<li class="item"><a href="/customize-ubuntu/icons/" title="Icons" >Icons</a></li>
		
			<li class="item"><a href="/customize-ubuntu/indicator/" title="Indicator" >Indicator</a></li>
		
			<li class="item"><a href="/customize-ubuntu/install/" title="Install" >Install</a></li>
		
			<li class="item"><a href="/customize-ubuntu/keyboard-shortcuts/" title="Keyboard Shortcuts" >Keyboard Shortcuts</a></li>
		
			<li class="item"><a href="/customize-ubuntu/live-cd/" title="Live CD" >Live CD</a></li>
		
			<li class="item"><a href="/customize-ubuntu/packages/" title="Packages" >Packages</a></li>
		
			<li class="item"><a href="/customize-ubuntu/privacy/" title="Privacy" >Privacy</a></li>
		
			<li class="item"><a href="/customize-ubuntu/settings/" title="Settings" >Settings</a></li>
		
			<li class="item"><a href="/customize-ubuntu/themes/" title="Themes" >Themes</a></li>
		
			<li class="item"><a href="/customize-ubuntu/window/" title="Window" >Window</a></li>
		
		</ul>
	
	</li>

	<li class="header"><a href="/harden-ubuntu/" title="Harden Ubuntu" >Harden Ubuntu</a>
	
		<ul>
		
			<li class="item"><a href="/harden-ubuntu/initial-setup/" title="Initial Setup" >Initial Setup</a></li>
		
			<li class="item"><a href="/harden-ubuntu/server-setup/" title="Server Setup" >Server Setup</a></li>
		
			<li class="item"><a href="/harden-ubuntu/disable-services/" title="Disabled Services" >Disabled Services</a></li>
		
			<li class="item"><a href="/harden-ubuntu/hardening/" title="Hardening" >Hardening</a></li>
		
			<li class="item"><a href="/harden-ubuntu/monitoring-tools/" title="Monitoring Tools" >Monitoring Tools</a></li>
		
			<li class="item"><a href="/harden-ubuntu/optimization/" title="Optimization" >Optimization</a></li>
		
			<li class="item"><a href="/harden-ubuntu/software/" title="Software" >Software</a></li>
		
			<li class="item"><a href="/harden-ubuntu/useful-commands/" title="Useful Commands" >Useful Commands</a></li>
		
			<li class="item"><a href="/harden-ubuntu/backup/" title="Backup" >Backup</a></li>
		
		</ul>
	
	</li>

</ul>
	</nav>

</aside>

<!-- content -->
<section>
	<article class="breadcrumbs">
	<a title="BookOfZeus" href="/">BookOfZeus</a> &gt; <a title="articles" href="/articles/">articles</a> &gt; <a title="mysql" href="/articles/mysql/">mysql</a>
</article>

<article>
	<header>
		<h1>Secure your Website from SQL Injections</h1>
		<h6>Posted on Thursday March 01, 2012 by Eric Potvin</h6>
	</header>

	
<h4>What is SQL Injection</h4>

<p class="note">
A SQL injection is often used to attack the security of a website by inputting SQL statements in a web form to get a badly designed website to perform operations on the database (often to dump the database content to the attacker) other than the usual operations as intended by the designer.
source: http://en.wikipedia.org/wiki/SQL_injection
</p>

<p>
Most of the SQL Injections web attacks comes from insecure forms. When someone submits a form, he can use, most of the time, any available characters and put inside the fields whatever he wants. This way, he can "inject" bad code and hope for an insecure process to get into the system.
</p>
<p>Here some examples of what he can inject:</p>
<ul>
	<li><code>' or 1 = 1; /* '</code></li>
	<li><code>' or 1 = 1; DROP TABLES `table`; /* '</code></li>
	<li><code>' or 1 = 1; SELECT SLEEP(86400); /* '</code></li>
</ul>
<p>
The first code will let the unwanted user to the system without having any valid credentials. The second one will allow him to drop any tables (if of course the permission is set, which sometimes all permissions are granted to the MySQL user) and the third one will execute the first query and in addition wait for the query to be completed in 86,400 seconds (or 1 day).</p>

<h4>How this works exactly?</h4>
<p>Let's use the classic login example. So on the back-end we will get something like this:</p>
<pre>
$username = $_POST['username'];
$password = $_POST['password'];
mysql_query("SELECT * FROM userTable WHERE username = '$username' AND password = '$password'");
</pre>

<p>If you insert malicious code, let's take the first example listed above, and use this code as the username.</p>
<pre>
mysql_query("SELECT * FROM userTable WHERE username = '' or 1 = 1; /* '' AND password = '$pw'");
</pre>

<p>As you can see, the query will check if the username is empty (which will return false) and check if <code>1</code> is equal to <code>1</code>, which will always be true, and then ignore the rest of the query because he uses the <code>;</code> to terminate the query and comment out the rest using <code>/*</code>.</p>

<h4>How to prevent this</h4>

<h5>use mysql_real_escape_string()</h5>

<p>The first thing you can use is the <code>mysql_real_escape_string()</code> function. This will escape the special characters in a string for use in an SQL statement. For example it will escape the single quotes (') and replace them with <code>\'</code>.</p>
<p>This will replace <code>' or 1 = 1; /* '</code> to <code>\' or 1 = 1; /* \'</code>. Therefore, fix the query string to:</p>
<pre>
$username = mysql_real_escape_string($_POST['username']);
mysql_query("SELECT * FROM userTable WHERE username = '\' or 1 = 1; /* \'' AND password = '$pw'");
</pre>

<h5>Clean the inputs</h5>
<p>Another solution is to clean the inputs. This practice basically removes unwanted chars and convert the special chars in HTML format.</p>
<pre>
function clean(&amp;$var, $default = '') {
  if(!isset($var)) {
    $var = $default;
    return;
  }
  $var = preg_replace("/[^a-zA-Z0-9@\"'\.\-_\s]/", "", trim($var));
  $var = htmlentities($var, ENT_QUOTES);
}
</pre>
<p>For example, this will convert the single quotes <code>'</code> to <code>'</code>.</p>

<p>This way, the string will look like:</p>
<pre>
$username = clean($_POST['username']);
mysql_query("SELECT * FROM userTable WHERE username = '' or 1 = 1; /* '' AND password = '$pw'");
</pre>

<h5>Prepare the statements</h5>

<p>This will prepare an SQL statement for execution. The SQL statement will be sent to the database and parsed separately.</p>
<pre>
$data = array(
 ':username' => $_POST['username']
 ':password' => $_POST['password']
);
$statement = $databaseConnection->prepare('SELECT * FROM userTable WHERE username = :username AND password = :password');
$statement->execute($data);
$rows = $statement->fetchAll();
</pre>

<p>This will automatically make all your variables safe for query execution.</p>



</article>

	<footer> 

		<h6>More links</h6>
		<a href="/about/" title="About">About</a>
		<a href="/codebase/" title="Codebase">CodeBase</a>
		<a href="/contribute/" title="Contribute">Contribute</a>

		<h6>NewsLetters</h6>
		<a href="http://eepurl.com/nCBQb" class="nw signUp">Sign up for our free newsletter!</a>
		<a href="http://bookofzeus.us5.list-manage.com/unsubscribe?u=6d11dcc020299e18618aa63a0&amp;id=f144c95830" class="nw unsub">Unsubscribe from our newsletter</a>
		<a href="http://eepurl.com/nCBVX" class="nw powered">Powered by MailChimp</a>

		<div>&copy; 2011-2018 BookOfZeus</div>
		<p>
			All articles, code or tutorials listed on bookofzeus.com can be used as reference, links or as in a sharing matter without attribution.
			You cannot copy whole tutorials (unless permission is given), either translating to another language.
			By using and/or reading this site, you agree to our <a href="/privacy-policy/" title="Privacy Policy">privacy policy</a> and <a href="/terms-of-conditions" title="terms and conditions">terms and conditions</a>.
		</p>

	</footer>

</section>

<!--
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
-->
<script src="/media/main.js"></script>

<script>

document.getElementById("home").addEventListener("click", function(e) {
	window.location.href = 'http://bookofzeus.com';
	e.preventDefault();
});
document.getElementById("home2").addEventListener("click", function(e) {
	window.location.href = 'http://bookofzeus.com';
	e.preventDefault();
});

var els = document.getElementsByTagName("a"), els_length = els.length;
for (var i = 0, l = els_length; i < l; i++) {
    var el = els[i];
    if (el.href.replace('http://bookofzeus.com','') == window.location.pathname) {
        el.className= "selected";
    }
}

</script>

</body>
</html>